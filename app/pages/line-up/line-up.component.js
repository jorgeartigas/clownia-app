"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var user_service_1 = require("./../../shared/user/user.service");
var core_1 = require("@angular/core");
var drawer_page_1 = require("../../shared/drawer/drawer.page");
var firebase = require("nativescript-plugin-firebase");
var Observable_1 = require("rxjs/Observable");
var LineUpComponent = /** @class */ (function (_super) {
    __extends(LineUpComponent, _super);
    function LineUpComponent(changeDetectorRef, userService) {
        var _this = _super.call(this, changeDetectorRef) || this;
        _this.changeDetectorRef = changeDetectorRef;
        _this.userService = userService;
        _this.artists = [];
        _this.myShedule = false;
        _this.artistsRef = firebase.firestore.collection("artists_preview").orderBy("name", "asc");
        _this.artistsBySetTime = firebase.firestore.collection("artists_preview").orderBy("set", "asc");
        // Own Schedule
        _this.localSchedule = [];
        _this.myScheduleArtists = [];
        // Artist by time
        _this.firstDay = [];
        _this.secondDay = [];
        _this.thirdDay = [];
        _this.fourthDay = [];
        // Artist by stages and times
        _this.mainStageSchedule = [];
        _this.plazaSchedule = [];
        _this.esplanadaSchedule = [];
        _this.carpaSchedule = [];
        // Stage toggles
        _this.mainStageToggle = false;
        _this.plazaToggle = false;
        _this.esplanadaToggle = false;
        _this.carpaToggle = false;
        return _this;
    }
    LineUpComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.artistsRef.get().then(function (snap) {
            snap.forEach(function (artist) {
                _this.artists.push(artist.data());
            });
        });
        this.fillSchedule();
        firebase.firestore.collection("user_schedules").doc(this.userService.userId).collection('artists').get().then(function (data) {
            data.forEach(function (element) {
                var date = new Date(element.data().set);
                element.data().set = date;
                _this.localSchedule.push(element.data());
            });
        }).then(function () {
            _this.localSchedule = _this.localSchedule.sort(function (a, b) { return new Date(a.set).getTime() - new Date(b.set).getTime(); });
        });
        //this.getMyScheduleObservable();
    };
    LineUpComponent.prototype.addToSchedule = function (artist) {
        var found = false;
        if (this.localSchedule.length > 0) {
            this.localSchedule.forEach(function (myArtist) {
                if (myArtist.id === artist.id) {
                    found = true;
                }
            });
        }
        if (!found) {
            this.localSchedule.push(artist);
            firebase.firestore.collection('user_schedules').doc(this.userService.userId).collection('artists').doc(artist.id).set(artist);
        }
    };
    LineUpComponent.prototype.removeFromSchedule = function (artist) {
        var _this = this;
        this.localSchedule.forEach(function (myArtist, index) {
            if (myArtist.id === artist.id) {
                _this.localSchedule.splice(index, 1);
                firebase.firestore.collection('user_schedules').doc(_this.userService.userId).collection('artists').doc(artist.id).delete();
            }
        });
    };
    LineUpComponent.prototype.getMyScheduleObservable = function () {
        var _this = this;
        this.myScheduleArtists$ = Observable_1.Observable.create(function (subscriber) {
            var scheduleRef = firebase.firestore.collection("user_schedules").doc(_this.userService.userId).collection('artists');
            scheduleRef.onSnapshot(function (snap) {
                _this.myScheduleArtists = [];
                snap.forEach(function (artist) { return _this.myScheduleArtists.push(artist.data()); });
                subscriber.next(_this.myScheduleArtists);
            });
        });
        this.myScheduleArtists$.subscribe();
    };
    LineUpComponent.prototype.ngOnDestroy = function () {
        console.log('destroy');
    };
    LineUpComponent.prototype.fillSchedule = function () {
        var _this = this;
        this.artistsBySetTime
            .get()
            .then(function (snap) {
            snap.forEach(function (doc) {
                if (doc.data().day == 'Dijous 28') {
                    _this.firstDay.push(doc.data());
                }
                else if (doc.data().day == 'Divendres 29') {
                    _this.secondDay.push(doc.data());
                }
                else if (doc.data().day == 'Dissabte 30') {
                    _this.thirdDay.push(doc.data());
                }
                else if (doc.data().day == 'Diumenge 1') {
                    _this.fourthDay.push(doc.data());
                }
                if (doc.data().stage === 'MAIN STAGE') {
                    _this.mainStageSchedule.push(doc.data());
                }
                else if (doc.data().stage === 'CARPA') {
                    _this.carpaSchedule.push(doc.data());
                }
                else if (doc.data().stage === 'PLAÃ‡A') {
                    _this.plazaSchedule.push(doc.data());
                }
                else {
                    _this.esplanadaSchedule.push(doc.data());
                }
            });
        }).then(function () {
            var oldDay = "";
            _this.mainStageSchedule.forEach(function (artist, index) {
                if (oldDay !== artist.day) {
                    _this.mainStageSchedule[index].firstDay = true;
                }
                else {
                    _this.mainStageSchedule[index].firstDay = false;
                }
                oldDay = artist.day;
            });
            var oldDay2 = "";
            _this.carpaSchedule.forEach(function (artist, index) {
                if (oldDay2 !== artist.day) {
                    _this.carpaSchedule[index].firstDay = true;
                }
                else {
                    _this.carpaSchedule[index].firstDay = false;
                }
                oldDay2 = artist.day;
            });
            var oldDay3 = "";
            _this.plazaSchedule.forEach(function (artist, index) {
                if (oldDay3 !== artist.day) {
                    _this.plazaSchedule[index].firstDay = true;
                }
                else {
                    _this.plazaSchedule[index].firstDay = false;
                }
                oldDay3 = artist.day;
            });
            var oldDay4 = "";
            _this.esplanadaSchedule.forEach(function (artist, index) {
                if (oldDay4 !== artist.day) {
                    _this.esplanadaSchedule[index].firstDay = true;
                }
                else {
                    _this.esplanadaSchedule[index].firstDay = false;
                }
                oldDay4 = artist.day;
            });
            var oldDay5 = "";
            _this.firstDay.forEach(function (artist, index) {
                if (oldDay5 !== artist.day) {
                    _this.firstDay[index].firstDay = true;
                }
                else {
                    _this.firstDay[index].firstDay = false;
                }
                oldDay5 = artist.day;
            });
            var oldDay6 = "";
            _this.secondDay.forEach(function (artist, index) {
                if (oldDay6 !== artist.day) {
                    _this.secondDay[index].firstDay = true;
                }
                else {
                    _this.secondDay[index].firstDay = false;
                }
                oldDay6 = artist.day;
            });
            var oldDay7 = "";
            _this.thirdDay.forEach(function (artist, index) {
                if (oldDay7 !== artist.day) {
                    _this.thirdDay[index].firstDay = true;
                }
                else {
                    _this.thirdDay[index].firstDay = false;
                }
                oldDay7 = artist.day;
            });
            var oldDay8 = "";
            _this.fourthDay.forEach(function (artist, index) {
                if (oldDay8 !== artist.day) {
                    _this.fourthDay[index].firstDay = true;
                }
                else {
                    _this.fourthDay[index].firstDay = false;
                }
                oldDay8 = artist.day;
            });
            _this.bySetTime = [].concat(_this.firstDay, _this.secondDay, _this.thirdDay, _this.fourthDay);
        });
    };
    LineUpComponent = __decorate([
        core_1.Component({
            selector: "line-up",
            moduleId: module.id,
            providers: [],
            templateUrl: "./line-up.component.html",
            styleUrls: ["./line-up-common.css"]
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef,
            user_service_1.UserService])
    ], LineUpComponent);
    return LineUpComponent;
}(drawer_page_1.DrawerPage));
exports.LineUpComponent = LineUpComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS11cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsaW5lLXVwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlFQUErRDtBQUMvRCxzQ0FBK0U7QUFDL0UsK0RBQTZEO0FBQzdELHVEQUF5RDtBQUV6RCw4Q0FBNkM7QUFXN0M7SUFBcUMsbUNBQVU7SUEwQjdDLHlCQUNVLGlCQUFvQyxFQUNwQyxXQUF3QjtRQUZsQyxZQUlFLGtCQUFNLGlCQUFpQixDQUFDLFNBQ3pCO1FBSlMsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyxpQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQTNCbEMsYUFBTyxHQUFVLEVBQUUsQ0FBQztRQUNwQixlQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLGdCQUFVLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BGLHNCQUFnQixHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUUxRixlQUFlO1FBQ2YsbUJBQWEsR0FBVSxFQUFFLENBQUM7UUFFMUIsdUJBQWlCLEdBQVUsRUFBRSxDQUFDO1FBQzlCLGlCQUFpQjtRQUNqQixjQUFRLEdBQVEsRUFBRSxDQUFDO1FBQ25CLGVBQVMsR0FBUSxFQUFFLENBQUM7UUFDcEIsY0FBUSxHQUFRLEVBQUUsQ0FBQztRQUNuQixlQUFTLEdBQVEsRUFBRSxDQUFDO1FBQ3BCLDZCQUE2QjtRQUM3Qix1QkFBaUIsR0FBUSxFQUFFLENBQUM7UUFDNUIsbUJBQWEsR0FBUSxFQUFFLENBQUM7UUFDeEIsdUJBQWlCLEdBQVEsRUFBRSxDQUFDO1FBQzVCLG1CQUFhLEdBQVEsRUFBRSxDQUFDO1FBQ3hCLGdCQUFnQjtRQUNo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QUMsU0FBUyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSSxDQUFDLFFBQVEsRUFBQyxLQUFJLENBQUMsU0FBUyxFQUFDLEtBQUksQ0FBQyxRQUFRLEVBQUMsS0FBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hGLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQWhNVSxlQUFlO1FBUjNCLGdCQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsU0FBUztZQUNuQixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsU0FBUyxFQUFFLEVBQUU7WUFDYixXQUFXLEVBQUUsMEJBQTBCO1lBQ3ZDLFNBQVMsRUFBRSxDQUFDLHNCQUFzQixDQUFDO1NBQ3BDLENBQUM7eUNBNkI2Qix3QkFBaUI7WUFDdkIsMEJBQVc7T0E1QnZCLGVBQWUsQ0FpTTNCO0lBQUQsc0JBQUM7Q0FBQSxBQWpNRCxDQUFxQyx3QkFBVSxHQWlNOUM7QUFqTVksMENBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVc2VyU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2hhcmVkL3VzZXIvdXNlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBDaGFuZ2VEZXRlY3RvclJlZiwgT25Jbml0LCBPbkRlc3Ryb3l9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IERyYXdlclBhZ2UgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL2RyYXdlci9kcmF3ZXIucGFnZVwiO1xyXG5pbXBvcnQgZmlyZWJhc2UgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZVwiKVxyXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3VzZXIvdXNlcic7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xyXG5pbXBvcnQgeyBmaXJlc3RvcmUgfSBmcm9tICduYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiBcImxpbmUtdXBcIixcclxuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxyXG4gIHByb3ZpZGVyczogW10sXHJcbiAgdGVtcGxhdGVVcmw6IFwiLi9saW5lLXVwLmNvbXBvbmVudC5odG1sXCIsXHJcbiAgc3R5bGVVcmxzOiBbXCIuL2xpbmUtdXAtY29tbW9uLmNzc1wiXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIExpbmVVcENvbXBvbmVudCBleHRlbmRzIERyYXdlclBhZ2UgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgYXJ0aXN0czogYW55W10gPSBbXTtcclxuICBteVNoZWR1bGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBhcnRpc3RzUmVmID0gZmlyZWJhc2UuZmlyZXN0b3JlLmNvbGxlY3Rpb24oXCJhcnRpc3RzX3ByZXZpZXdcIikub3JkZXJCeShcIm5hbWVcIixcImFzY1wiKTtcclxuICBhcnRpc3RzQnlTZXRUaW1lID0gZmlyZWJhc2UuZmlyZXN0b3JlLmNvbGxlY3Rpb24oXCJhcnRpc3RzX3ByZXZpZXdcIikub3JkZXJCeShcInNldFwiLCBcImFzY1wiKTtcclxuICBieVNldFRpbWU6IGFueTtcclxuICAvLyBPd24gU2NoZWR1bGVcclxuICBsb2NhbFNjaGVkdWxlOiBhbnlbXSA9IFtdO1xyXG4gIG15U2NoZWR1bGVBcnRpc3RzJDogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIG15U2NoZWR1bGVBcnRpc3RzOiBhbnlbXSA9IFtdO1xyXG4gIC8vIEFydGlzdCBieSB0aW1lXHJcbiAgZmlyc3REYXk6IGFueSA9IFtdO1xyXG4gIHNlY29uZERheTogYW55ID0gW107XHJcbiAgdGhpcmREYXk6IGFueSA9IFtdO1xyXG4gIGZvdXJ0aERheTogYW55ID0gW107XHJcbiAgLy8gQXJ0aXN0IGJ5IHN0YWdlcyBhbmQgdGltZXNcclxuICBtYWluU3RhZ2VTY2hlZHVsZTogYW55ID0gW107XHJcbiAgcGxhemFTY2hlZHVsZTogYW55ID0gW107XHJcbiAgZXNwbGFuYWRhU2NoZWR1bGU6IGFueSA9IFtdO1xyXG4gIGNhcnBhU2NoZWR1bGU6IGFueSA9IFtdO1xyXG4gIC8vIFN0YWdlIHRvZ2dsZXNcclxuICBtYWluU3RhZ2VUb2dnbGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwbGF6YVRvZ2dsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGVzcGxhbmFkYVRvZ2dsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGNhcnBhVG9nZ2xlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwcml2YXRlIHVzZXJTZXJ2aWNlOiBVc2VyU2VydmljZVxyXG4gICl7XHJcbiAgICBzdXBlcihjaGFuZ2VEZXRlY3RvclJlZik7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuYXJ0aXN0c1JlZi5nZXQoKS50aGVuKHNuYXAgPT4ge1xyXG4gICAgICBzbmFwLmZvckVhY2goYXJ0aXN0ID0+IHtcclxuICAgICAgICB0aGlzLmFydGlzdHMucHVzaChhcnRpc3QuZGF0YSgpKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuZmlsbFNjaGVkdWxlKCk7XHJcbiAgICBmaXJlYmFzZS5maXJlc3RvcmUuY29sbGVjdGlvbihcInVzZXJfc2NoZWR1bGVzXCIpLmRvYyh0aGlzLnVzZXJTZXJ2aWNlLnVzZXJJZCkuY29sbGVjdGlvbignYXJ0aXN0cycpLmdldCgpLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgIGRhdGEuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZWxlbWVudC5kYXRhKCkuc2V0KTtcclxuICAgICAgICBlbGVtZW50LmRhdGEoKS5zZXQgPSBkYXRlOyBcclxuICAgICAgICB0aGlzLmxvY2FsU2NoZWR1bGUucHVzaChlbGVtZW50LmRhdGEoKSk7XHJcbiAgICAgIH0pOyAgXHJcbiAgICB9KS50aGVuKCgpPT57XHJcbiAgICAgIHRoaXMubG9jYWxTY2hlZHVsZSA9IHRoaXMubG9jYWxTY2hlZHVsZS5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4gbmV3IERhdGUoYS5zZXQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGIuc2V0KS5nZXRUaW1lKCkpO1xyXG4gICAgfSlcclxuICAgIC8vdGhpcy5nZXRNeVNjaGVkdWxlT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFRvU2NoZWR1bGUoYXJ0aXN0OiBhbnkpOiB2b2lkIHtcclxuICAgIGxldCBmb3VuZCA9IGZhbHNlO1xyXG4gICAgaWYgKHRoaXMubG9jYWxTY2hlZHVsZS5sZW5ndGg+MCkge1xyXG4gICAgICB0aGlzLmxvY2FsU2NoZWR1bGUuZm9yRWFjaChteUFydGlzdCA9PiB7XHJcbiAgICAgICAgaWYgKG15QXJ0aXN0LmlkID09PSBhcnRpc3QuaWQpIHtcclxuICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBpZiAoIWZvdW5kKSB7XHJcbiAgICAgIHRoaXMubG9jYWxTY2hlZHVsZS5wdXNoKGFydGlzdCk7XHJcbiAgICAgIGZpcmViYXNlLmZpcmVzdG9yZS5jb2xsZWN0aW9uKCd1c2VyX3NjaGVkdWxlcycpLmRvYyh0aGlzLnVzZXJTZXJ2aWNlLnVzZXJJZCkuY29sbGVjdGlvbignYXJ0aXN0cycpLmRvYyhhcnRpc3QuaWQpLnNldChhcnRpc3QpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlbW92ZUZyb21TY2hlZHVsZShhcnRpc3Q6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2NhbFNjaGVkdWxlLmZvckVhY2goKG15QXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChteUFydGlzdC5pZCA9PT0gYXJ0aXN0LmlkKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhbFNjaGVkdWxlLnNwbGljZShpbmRleCwxKTtcclxuICAgICAgICBmaXJlYmFzZS5maXJlc3RvcmUuY29sbGVjdGlvbigndXNlcl9zY2hlZHVsZXMnKS5kb2ModGhpcy51c2VyU2VydmljZS51c2VySWQpLmNvbGxlY3Rpb24oJ2FydGlzdHMnKS5kb2MoYXJ0aXN0LmlkKS5kZWxldGUoKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TXlTY2hlZHVsZU9ic2VydmFibGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLm15U2NoZWR1bGVBcnRpc3RzJCA9IE9ic2VydmFibGUuY3JlYXRlKHN1YnNjcmliZXIgPT4ge1xyXG4gICAgICBjb25zdCBzY2hlZHVsZVJlZiA9IGZpcmViYXNlLmZpcmVzdG9yZS5jb2xsZWN0aW9uKFwidXNlcl9zY2hlZHVsZXNcIikuZG9jKHRoaXMudXNlclNlcnZpY2UudXNlcklkKS5jb2xsZWN0aW9uKCdhcnRpc3RzJyk7XHJcbiAgICAgIHNjaGVkdWxlUmVmLm9uU25hcHNob3Qoc25hcCA9PiB7XHJcbiAgICAgICAgdGhpcy5teVNjaGVkdWxlQXJ0aXN0cyA9IFtdO1xyXG4gICAgICAgIHNuYXAuZm9yRWFjaChhcnRpc3QgPT4gdGhpcy5teVNjaGVkdWxlQXJ0aXN0cy5wdXNoKGFydGlzdC5kYXRhKCkpKTtcclxuICAgICAgICBzdWJzY3JpYmVyLm5leHQodGhpcy5teVNjaGVkdWxlQXJ0aXN0cyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm15U2NoZWR1bGVBcnRpc3RzJC5zdWJzY3JpYmUoKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coJ2Rlc3Ryb3knKVxyXG5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmlsbFNjaGVkdWxlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hcnRpc3RzQnlTZXRUaW1lXHJcbiAgICAuZ2V0KClcclxuICAgIC50aGVuKHNuYXAgPT4ge1xyXG4gICAgICBzbmFwLmZvckVhY2goZG9jID0+IHtcclxuICAgICAgICBpZihkb2MuZGF0YSgpLmRheSA9PSAnRGlqb3VzIDI4Jykge1xyXG4gICAgICAgICAgdGhpcy5maXJzdERheS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZG9jLmRhdGEoKS5kYXkgPT0gJ0RpdmVuZHJlcyAyOScpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWNvbmREYXkucHVzaChkb2MuZGF0YSgpKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZG9jLmRhdGEoKS5kYXkgPT0gJ0Rpc3NhYnRlIDMwJykge1xyXG4gICAgICAgICAgICAgIHRoaXMudGhpcmREYXkucHVzaChkb2MuZGF0YSgpKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkb2MuZGF0YSgpLmRheSA9PSAnRGl1bWVuZ2UgMScpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mb3VydGhEYXkucHVzaChkb2MuZGF0YSgpKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgaWYoZG9jLmRhdGEoKS5zdGFnZSA9PT0gJ01BSU4gU1RBR0UnKSB7XHJcbiAgICAgICAgICB0aGlzLm1haW5TdGFnZVNjaGVkdWxlLnB1c2goZG9jLmRhdGEoKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkb2MuZGF0YSgpLnN0YWdlID09PSAnQ0FSUEEnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FycGFTY2hlZHVsZS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChkb2MuZGF0YSgpLnN0YWdlID09PSAnUExBw4dBJykge1xyXG4gICAgICAgICAgICAgIHRoaXMucGxhemFTY2hlZHVsZS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lc3BsYW5hZGFTY2hlZHVsZS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSkudGhlbigoKT0+e1xyXG4gICAgICBsZXQgb2xkRGF5ID0gXCJcIjtcclxuICAgICAgdGhpcy5tYWluU3RhZ2VTY2hlZHVsZS5mb3JFYWNoKChhcnRpc3QsaW5kZXgpID0+IHtcclxuICAgICAgICBpZihvbGREYXkgIT09IGFydGlzdC5kYXkpe1xyXG4gICAgICAgICAgdGhpcy5tYWluU3RhZ2VTY2hlZHVsZVtpbmRleF0uZmlyc3REYXkgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm1haW5TdGFnZVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXkgPSBhcnRpc3QuZGF5O1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IG9sZERheTIgPSBcIlwiO1xyXG4gICAgICB0aGlzLmNhcnBhU2NoZWR1bGUuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5MiAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLmNhcnBhU2NoZWR1bGVbaW5kZXhdLmZpcnN0RGF5ID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jYXJwYVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXkyID0gYXJ0aXN0LmRheTtcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCBvbGREYXkzID0gXCJcIjtcclxuICAgICAgdGhpcy5wbGF6YVNjaGVkdWxlLmZvckVhY2goKGFydGlzdCxpbmRleCkgPT4ge1xyXG4gICAgICAgIGlmKG9sZERheTMgIT09IGFydGlzdC5kYXkpe1xyXG4gICAgICAgICAgdGhpcy5wbGF6YVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucGxhemFTY2hlZHVsZVtpbmRleF0uZmlyc3REYXkgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2xkRGF5MyA9IGFydGlzdC5kYXk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBsZXQgb2xkRGF5NCA9IFwiXCI7XHJcbiAgICAgIHRoaXMuZXNwbGFuYWRhU2NoZWR1bGUuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5NCAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLmVzcGxhbmFkYVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZXNwbGFuYWRhU2NoZWR1bGVbaW5kZXhdLmZpcnN0RGF5ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9sZERheTQgPSBhcnRpc3QuZGF5O1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IG9sZERheTUgPSBcIlwiO1xyXG4gICAgICB0aGlzLmZpcnN0RGF5LmZvckVhY2goKGFydGlzdCxpbmRleCkgPT4ge1xyXG4gICAgICAgIGlmKG9sZERheTUgIT09IGFydGlzdC5kYXkpe1xyXG4gICAgICAgICAgdGhpcy5maXJzdERheVtpbmRleF0uZmlyc3REYXkgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmZpcnN0RGF5W2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXk1ID0gYXJ0aXN0LmRheTtcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCBvbGREYXk2ID0gXCJcIjtcclxuICAgICAgdGhpcy5zZWNvbmREYXkuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5NiAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLnNlY29uZERheVtpbmRleF0uZmlyc3REYXkgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnNlY29uZERheVtpbmRleF0uZmlyc3REYXkgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2xkRGF5NiA9IGFydGlzdC5kYXk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBsZXQgb2xkRGF5NyA9IFwiXCI7XHJcbiAgICAgIHRoaXMudGhpcmREYXkuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5NyAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLnRoaXJkRGF5W2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMudGhpcmREYXlbaW5kZXhdLmZpcnN0RGF5ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9sZERheTcgPSBhcnRpc3QuZGF5O1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IG9sZERheTggPSBcIlwiO1xyXG4gICAgICB0aGlzLmZvdXJ0aERheS5mb3JFYWNoKChhcnRpc3QsaW5kZXgpID0+IHtcclxuICAgICAgICBpZihvbGREYXk4ICE9PSBhcnRpc3QuZGF5KXtcclxuICAgICAgICAgIHRoaXMuZm91cnRoRGF5W2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZm91cnRoRGF5W2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXk4ID0gYXJ0aXN0LmRheTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuYnlTZXRUaW1lID0gW10uY29uY2F0KHRoaXMuZmlyc3REYXksdGhpcy5zZWNvbmREYXksdGhpcy50aGlyZERheSx0aGlzLmZvdXJ0aERheSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn0iXX0=