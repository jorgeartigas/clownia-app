"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var user_service_1 = require("./../../shared/user/user.service");
var core_1 = require("@angular/core");
var drawer_page_1 = require("../../shared/drawer/drawer.page");
var firebase = require("nativescript-plugin-firebase");
var LocalNotifications = require("nativescript-local-notifications");
var LineUpComponent = /** @class */ (function (_super) {
    __extends(LineUpComponent, _super);
    function LineUpComponent(changeDetectorRef, userService) {
        var _this = _super.call(this, changeDetectorRef) || this;
        _this.changeDetectorRef = changeDetectorRef;
        _this.userService = userService;
        _this.artists = [];
        _this.myShedule = false;
        _this.artistsRef = firebase.firestore.collection("artists_preview").orderBy("name", "asc");
        _this.artistsBySetTime = firebase.firestore.collection("artists_preview").orderBy("set", "asc");
        // Own Schedule
        _this.localSchedule = [];
        _this.myScheduleArtists = [];
        // Artist by time
        _this.firstDay = [];
        _this.secondDay = [];
        _this.thirdDay = [];
        _this.fourthDay = [];
        // Artist by stages and times
        _this.mainStageSchedule = [];
        _this.plazaSchedule = [];
        _this.esplanadaSchedule = [];
        _this.carpaSchedule = [];
        // Stage toggles
        _this.mainStageToggle = false;
        _this.plazaToggle = false;
        _this.esplanadaToggle = false;
        _this.carpaToggle = false;
        return _this;
    }
    LineUpComponent.prototype.ngOnInit = function () {
        var _this = this;
        LocalNotifications.hasPermission();
        this.artistsRef.get().then(function (snap) {
            snap.forEach(function (artist) {
                _this.artists.push(artist.data());
            });
        });
        this.fillSchedule();
        firebase.firestore.collection("user_schedules").doc(this.userService.userId).collection('artists').get().then(function (data) {
            data.forEach(function (element) {
                var date = new Date(element.data().set);
                element.data().set = date;
                _this.localSchedule.push(element.data());
            });
        }).then(function () {
            _this.localSchedule = _this.localSchedule.sort(function (a, b) { return new Date(a.set).getTime() - new Date(b.set).getTime(); });
        });
        //this.getMyScheduleObservable();
    };
    LineUpComponent.prototype.addToSchedule = function (artist) {
        var found = false;
        if (this.localSchedule.length > 0) {
            this.localSchedule.forEach(function (myArtist) {
                if (myArtist.id === artist.id) {
                    found = true;
                }
            });
        }
        if (!found) {
            console.log(artist);
            this.setNotification(artist);
            this.localSchedule.push(artist);
            firebase.firestore.collection('user_schedules').doc(this.userService.userId).collection('artists').doc(artist.id).set(artist);
        }
    };
    LineUpComponent.prototype.removeFromSchedule = function (artist) {
        var _this = this;
        this.localSchedule.forEach(function (myArtist, index) {
            if (myArtist.id === artist.id) {
                _this.localSchedule.splice(index, 1);
                firebase.firestore.collection('user_schedules').doc(_this.userService.userId).collection('artists').doc(artist.id).delete();
            }
        });
    };
    LineUpComponent.prototype.fillSchedule = function () {
        var _this = this;
        this.artistsBySetTime
            .get()
            .then(function (snap) {
            snap.forEach(function (doc) {
                if (doc.data().day == 'Dijous 28') {
                    _this.firstDay.push(doc.data());
                }
                else if (doc.data().day == 'Divendres 29') {
                    _this.secondDay.push(doc.data());
                }
                else if (doc.data().day == 'Dissabte 30') {
                    _this.thirdDay.push(doc.data());
                }
                else if (doc.data().day == 'Diumenge 1') {
                    _this.fourthDay.push(doc.data());
                }
                if (doc.data().stage === 'MAIN STAGE') {
                    _this.mainStageSchedule.push(doc.data());
                }
                else if (doc.data().stage === 'CARPA') {
                    _this.carpaSchedule.push(doc.data());
                }
                else if (doc.data().stage === 'PLAÃ‡A') {
                    _this.plazaSchedule.push(doc.data());
                }
                else {
                    _this.esplanadaSchedule.push(doc.data());
                }
            });
        }).then(function () {
            var oldDay = "";
            _this.mainStageSchedule.forEach(function (artist, index) {
                if (oldDay !== artist.day) {
                    _this.mainStageSchedule[index].firstDay = true;
                }
                else {
                    _this.mainStageSchedule[index].firstDay = false;
                }
                oldDay = artist.day;
            });
            var oldDay2 = "";
            _this.carpaSchedule.forEach(function (artist, index) {
                if (oldDay2 !== artist.day) {
                    _this.carpaSchedule[index].firstDay = true;
                }
                else {
                    _this.carpaSchedule[index].firstDay = false;
                }
                oldDay2 = artist.day;
            });
            var oldDay3 = "";
            _this.plazaSchedule.forEach(function (artist, index) {
                if (oldDay3 !== artist.day) {
                    _this.plazaSchedule[index].firstDay = true;
                }
                else {
                    _this.plazaSchedule[index].firstDay = false;
                }
                oldDay3 = artist.day;
            });
            var oldDay4 = "";
            _this.esplanadaSchedule.forEach(function (artist, index) {
                if (oldDay4 !== artist.day) {
                    _this.esplanadaSchedule[index].firstDay = true;
                }
                else {
                    _this.esplanadaSchedule[index].firstDay = false;
                }
                oldDay4 = artist.day;
            });
            var oldDay5 = "";
            _this.firstDay.forEach(function (artist, index) {
                if (oldDay5 !== artist.day) {
                    _this.firstDay[index].firstDay = true;
                }
                else {
                    _this.firstDay[index].firstDay = false;
                }
                oldDay5 = artist.day;
            });
            var oldDay6 = "";
            _this.secondDay.forEach(function (artist, index) {
                if (oldDay6 !== artist.day) {
                    _this.secondDay[index].firstDay = true;
                }
                else {
                    _this.secondDay[index].firstDay = false;
                }
                oldDay6 = artist.day;
            });
            var oldDay7 = "";
            _this.thirdDay.forEach(function (artist, index) {
                if (oldDay7 !== artist.day) {
                    _this.thirdDay[index].firstDay = true;
                }
                else {
                    _this.thirdDay[index].firstDay = false;
                }
                oldDay7 = artist.day;
            });
            var oldDay8 = "";
            _this.fourthDay.forEach(function (artist, index) {
                if (oldDay8 !== artist.day) {
                    _this.fourthDay[index].firstDay = true;
                }
                else {
                    _this.fourthDay[index].firstDay = false;
                }
                oldDay8 = artist.day;
            });
            _this.bySetTime = [].concat(_this.firstDay, _this.secondDay, _this.thirdDay, _this.fourthDay);
        });
    };
    LineUpComponent.prototype.setNotification = function (artist) {
        LocalNotifications.schedule([{
                id: 1,
                title: 'Va a empezar',
                body: 'Recurs every minute until cancelled',
                ticker: 'The ticker',
                badge: 1,
                groupedMessages: ["The first", "Second", "Keep going", "one more..", "OK Stop"],
                groupSummary: "Summary of the grouped messages above",
                ongoing: true,
                smallIcon: 'res://heart',
                interval: 'minute',
                sound: "customsound-ios.wav",
                at: new Date(new Date().getTime() + (10 * 1000)) // 10 seconds from now
            }]).then(function () {
            console.log("Notification scheduled");
        }, function (error) {
            console.log("scheduling error: " + error);
        });
    };
    LineUpComponent = __decorate([
        core_1.Component({
            selector: "line-up",
            moduleId: module.id,
            providers: [],
            templateUrl: "./line-up.component.html",
            styleUrls: ["./line-up-common.css"]
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef,
            user_service_1.UserService])
    ], LineUpComponent);
    return LineUpComponent;
}(drawer_page_1.DrawerPage));
exports.LineUpComponent = LineUpComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS11cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsaW5lLXVwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlFQUErRDtBQUMvRCxzQ0FBb0U7QUFDcEUsK0RBQTZEO0FBQzdELHVEQUF5RDtBQUV6RCxxRUFBdUU7QUFVdkU7SUFBcUMsbUNBQVU7SUEwQjdDLHlCQUNVLGlCQUFvQyxFQUNwQyxXQUF3QjtRQUZsQyxZQUlFLGtCQUFNLGlCQUFpQixDQUFDLFNBQ3pCO1FBSlMsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyxpQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQTNCbEMsYUFBTyxHQUFVLEVBQUUsQ0FBQztRQUNwQixlQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLGdCQUFVLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BGLHNCQUFnQixHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUUxRixlQUFlO1FBQ2YsbUJBQWEsR0FBVSxFQUFFLENBQUM7UUFFMUIsdUJBQWlCLEdBQVUsRUFBRSxDQUFDO1FBQzlCLGlCQUFpQjtRQUNqQixjQUFRLEdBQVEsRUFBRSxDQUFDO1FBQ25CLGVBQVMsR0FBUSxFQUFFLENBQUM7UUFDcEIsY0FBUSxHQUFRLEVBQUUsQ0FBQztRQUNuQixlQUFTLEdBQVEsRUFBRSxDQUFDO1FBQ3BCLDZCQUE2QjtRQUM3Qix1QkFBaUIsR0FBUSxFQUFFLENBQUM7UUFDNUIsbUJBQWEsR0FBUSxFQUFFLENBQUM7UUFDeEIsdUJBQWlCLEdBQVEsRUFBRSxDQUFDO1FBQzVCLG1CQUFhLEdBQVEsRUFBRSxDQUFDO1FBQ3hCLGdCQUFnQjtRQUNo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LElBQUksQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsc0JBQXNCO2FBQ3hFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDSjtZQUNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUN4QyxDQUFDLEVBQ0QsVUFBUyxLQUFLO1lBQ1osT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQ0osQ0FBQTtJQUNILENBQUM7SUExTVUsZUFBZTtRQVIzQixnQkFBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFNBQVM7WUFDbkIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFNBQVMsRUFBRSxFQUFFO1lBQ2IsV0FBVyxFQUFFLDBCQUEwQjtZQUN2QyxTQUFTLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQztTQUNwQyxDQUFDO3lDQTZCNkIsd0JBQWlCO1lBQ3ZCLDBCQUFXO09BNUJ2QixlQUFlLENBMk0zQjtJQUFELHNCQUFDO0NBQUEsQUEzTUQsQ0FBcUMsd0JBQVUsR0EyTTlDO0FBM01ZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVXNlclNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NoYXJlZC91c2VyL3VzZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9uSW5pdH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgRHJhd2VyUGFnZSB9IGZyb20gXCIuLi8uLi9zaGFyZWQvZHJhd2VyL2RyYXdlci5wYWdlXCI7XHJcbmltcG9ydCBmaXJlYmFzZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlXCIpXHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xyXG5pbXBvcnQgKiBhcyBMb2NhbE5vdGlmaWNhdGlvbnMgZnJvbSBcIm5hdGl2ZXNjcmlwdC1sb2NhbC1ub3RpZmljYXRpb25zXCI7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogXCJsaW5lLXVwXCIsXHJcbiAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcclxuICBwcm92aWRlcnM6IFtdLFxyXG4gIHRlbXBsYXRlVXJsOiBcIi4vbGluZS11cC5jb21wb25lbnQuaHRtbFwiLFxyXG4gIHN0eWxlVXJsczogW1wiLi9saW5lLXVwLWNvbW1vbi5jc3NcIl1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBMaW5lVXBDb21wb25lbnQgZXh0ZW5kcyBEcmF3ZXJQYWdlIGltcGxlbWVudHMgT25Jbml0IHtcclxuICBhcnRpc3RzOiBhbnlbXSA9IFtdO1xyXG4gIG15U2hlZHVsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGFydGlzdHNSZWYgPSBmaXJlYmFzZS5maXJlc3RvcmUuY29sbGVjdGlvbihcImFydGlzdHNfcHJldmlld1wiKS5vcmRlckJ5KFwibmFtZVwiLFwiYXNjXCIpO1xyXG4gIGFydGlzdHNCeVNldFRpbWUgPSBmaXJlYmFzZS5maXJlc3RvcmUuY29sbGVjdGlvbihcImFydGlzdHNfcHJldmlld1wiKS5vcmRlckJ5KFwic2V0XCIsIFwiYXNjXCIpO1xyXG4gIGJ5U2V0VGltZTogYW55O1xyXG4gIC8vIE93biBTY2hlZHVsZVxyXG4gIGxvY2FsU2NoZWR1bGU6IGFueVtdID0gW107XHJcbiAgbXlTY2hlZHVsZUFydGlzdHMkOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgbXlTY2hlZHVsZUFydGlzdHM6IGFueVtdID0gW107XHJcbiAgLy8gQXJ0aXN0IGJ5IHRpbWVcclxuICBmaXJzdERheTogYW55ID0gW107XHJcbiAgc2Vjb25kRGF5OiBhbnkgPSBbXTtcclxuICB0aGlyZERheTogYW55ID0gW107XHJcbiAgZm91cnRoRGF5OiBhbnkgPSBbXTtcclxuICAvLyBBcnRpc3QgYnkgc3RhZ2VzIGFuZCB0aW1lc1xyXG4gIG1haW5TdGFnZVNjaGVkdWxlOiBhbnkgPSBbXTtcclxuICBwbGF6YVNjaGVkdWxlOiBhbnkgPSBbXTtcclxuICBlc3BsYW5hZGFTY2hlZHVsZTogYW55ID0gW107XHJcbiAgY2FycGFTY2hlZHVsZTogYW55ID0gW107XHJcbiAgLy8gU3RhZ2UgdG9nZ2xlc1xyXG4gIG1haW5TdGFnZVRvZ2dsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHBsYXphVG9nZ2xlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgZXNwbGFuYWRhVG9nZ2xlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgY2FycGFUb2dnbGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIHByaXZhdGUgdXNlclNlcnZpY2U6IFVzZXJTZXJ2aWNlXHJcbiAgKXtcclxuICAgIHN1cGVyKGNoYW5nZURldGVjdG9yUmVmKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgTG9jYWxOb3RpZmljYXRpb25zLmhhc1Blcm1pc3Npb24oKTtcclxuICAgIHRoaXMuYXJ0aXN0c1JlZi5nZXQoKS50aGVuKHNuYXAgPT4ge1xyXG4gICAgICBzbmFwLmZvckVhY2goYXJ0aXN0ID0+IHtcclxuICAgICAgICB0aGlzLmFydGlzdHMucHVzaChhcnRpc3QuZGF0YSgpKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuZmlsbFNjaGVkdWxlKCk7XHJcbiAgICBmaXJlYmFzZS5maXJlc3RvcmUuY29sbGVjdGlvbihcInVzZXJfc2NoZWR1bGVzXCIpLmRvYyh0aGlzLnVzZXJTZXJ2aWNlLnVzZXJJZCkuY29sbGVjdGlvbignYXJ0aXN0cycpLmdldCgpLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgIGRhdGEuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZWxlbWVudC5kYXRhKCkuc2V0KTtcclxuICAgICAgICBlbGVtZW50LmRhdGEoKS5zZXQgPSBkYXRlOyBcclxuICAgICAgICB0aGlzLmxvY2FsU2NoZWR1bGUucHVzaChlbGVtZW50LmRhdGEoKSk7XHJcbiAgICAgIH0pOyAgXHJcbiAgICB9KS50aGVuKCgpPT57XHJcbiAgICAgIHRoaXMubG9jYWxTY2hlZHVsZSA9IHRoaXMubG9jYWxTY2hlZHVsZS5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4gbmV3IERhdGUoYS5zZXQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGIuc2V0KS5nZXRUaW1lKCkpO1xyXG4gICAgfSlcclxuICAgIC8vdGhpcy5nZXRNeVNjaGVkdWxlT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFRvU2NoZWR1bGUoYXJ0aXN0OiBhbnkpOiB2b2lkIHtcclxuICAgIGxldCBmb3VuZCA9IGZhbHNlO1xyXG4gICAgaWYgKHRoaXMubG9jYWxTY2hlZHVsZS5sZW5ndGg+MCkge1xyXG4gICAgICB0aGlzLmxvY2FsU2NoZWR1bGUuZm9yRWFjaChteUFydGlzdCA9PiB7XHJcbiAgICAgICAgaWYgKG15QXJ0aXN0LmlkID09PSBhcnRpc3QuaWQpIHtcclxuICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBpZiAoIWZvdW5kKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGFydGlzdCk7XHJcbiAgICAgIHRoaXMuc2V0Tm90aWZpY2F0aW9uKGFydGlzdCk7XHJcbiAgICAgIHRoaXMubG9jYWxTY2hlZHVsZS5wdXNoKGFydGlzdCk7XHJcbiAgICAgIGZpcmViYXNlLmZpcmVzdG9yZS5jb2xsZWN0aW9uKCd1c2VyX3NjaGVkdWxlcycpLmRvYyh0aGlzLnVzZXJTZXJ2aWNlLnVzZXJJZCkuY29sbGVjdGlvbignYXJ0aXN0cycpLmRvYyhhcnRpc3QuaWQpLnNldChhcnRpc3QpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlbW92ZUZyb21TY2hlZHVsZShhcnRpc3Q6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2NhbFNjaGVkdWxlLmZvckVhY2goKG15QXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChteUFydGlzdC5pZCA9PT0gYXJ0aXN0LmlkKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhbFNjaGVkdWxlLnNwbGljZShpbmRleCwxKTtcclxuICAgICAgICBmaXJlYmFzZS5maXJlc3RvcmUuY29sbGVjdGlvbigndXNlcl9zY2hlZHVsZXMnKS5kb2ModGhpcy51c2VyU2VydmljZS51c2VySWQpLmNvbGxlY3Rpb24oJ2FydGlzdHMnKS5kb2MoYXJ0aXN0LmlkKS5kZWxldGUoKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmlsbFNjaGVkdWxlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hcnRpc3RzQnlTZXRUaW1lXHJcbiAgICAuZ2V0KClcclxuICAgIC50aGVuKHNuYXAgPT4ge1xyXG4gICAgICBzbmFwLmZvckVhY2goZG9jID0+IHtcclxuICAgICAgICBpZihkb2MuZGF0YSgpLmRheSA9PSAnRGlqb3VzIDI4Jykge1xyXG4gICAgICAgICAgdGhpcy5maXJzdERheS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZG9jLmRhdGEoKS5kYXkgPT0gJ0RpdmVuZHJlcyAyOScpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWNvbmREYXkucHVzaChkb2MuZGF0YSgpKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZG9jLmRhdGEoKS5kYXkgPT0gJ0Rpc3NhYnRlIDMwJykge1xyXG4gICAgICAgICAgICAgIHRoaXMudGhpcmREYXkucHVzaChkb2MuZGF0YSgpKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkb2MuZGF0YSgpLmRheSA9PSAnRGl1bWVuZ2UgMScpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mb3VydGhEYXkucHVzaChkb2MuZGF0YSgpKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgaWYoZG9jLmRhdGEoKS5zdGFnZSA9PT0gJ01BSU4gU1RBR0UnKSB7XHJcbiAgICAgICAgICB0aGlzLm1haW5TdGFnZVNjaGVkdWxlLnB1c2goZG9jLmRhdGEoKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkb2MuZGF0YSgpLnN0YWdlID09PSAnQ0FSUEEnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FycGFTY2hlZHVsZS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChkb2MuZGF0YSgpLnN0YWdlID09PSAnUExBw4dBJykge1xyXG4gICAgICAgICAgICAgIHRoaXMucGxhemFTY2hlZHVsZS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lc3BsYW5hZGFTY2hlZHVsZS5wdXNoKGRvYy5kYXRhKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSkudGhlbigoKT0+e1xyXG4gICAgICBsZXQgb2xkRGF5ID0gXCJcIjtcclxuICAgICAgdGhpcy5tYWluU3RhZ2VTY2hlZHVsZS5mb3JFYWNoKChhcnRpc3QsaW5kZXgpID0+IHtcclxuICAgICAgICBpZihvbGREYXkgIT09IGFydGlzdC5kYXkpe1xyXG4gICAgICAgICAgdGhpcy5tYWluU3RhZ2VTY2hlZHVsZVtpbmRleF0uZmlyc3REYXkgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm1haW5TdGFnZVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXkgPSBhcnRpc3QuZGF5O1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IG9sZERheTIgPSBcIlwiO1xyXG4gICAgICB0aGlzLmNhcnBhU2NoZWR1bGUuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5MiAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLmNhcnBhU2NoZWR1bGVbaW5kZXhdLmZpcnN0RGF5ID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jYXJwYVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXkyID0gYXJ0aXN0LmRheTtcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCBvbGREYXkzID0gXCJcIjtcclxuICAgICAgdGhpcy5wbGF6YVNjaGVkdWxlLmZvckVhY2goKGFydGlzdCxpbmRleCkgPT4ge1xyXG4gICAgICAgIGlmKG9sZERheTMgIT09IGFydGlzdC5kYXkpe1xyXG4gICAgICAgICAgdGhpcy5wbGF6YVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucGxhemFTY2hlZHVsZVtpbmRleF0uZmlyc3REYXkgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2xkRGF5MyA9IGFydGlzdC5kYXk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBsZXQgb2xkRGF5NCA9IFwiXCI7XHJcbiAgICAgIHRoaXMuZXNwbGFuYWRhU2NoZWR1bGUuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5NCAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLmVzcGxhbmFkYVNjaGVkdWxlW2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZXNwbGFuYWRhU2NoZWR1bGVbaW5kZXhdLmZpcnN0RGF5ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9sZERheTQgPSBhcnRpc3QuZGF5O1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IG9sZERheTUgPSBcIlwiO1xyXG4gICAgICB0aGlzLmZpcnN0RGF5LmZvckVhY2goKGFydGlzdCxpbmRleCkgPT4ge1xyXG4gICAgICAgIGlmKG9sZERheTUgIT09IGFydGlzdC5kYXkpe1xyXG4gICAgICAgICAgdGhpcy5maXJzdERheVtpbmRleF0uZmlyc3REYXkgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmZpcnN0RGF5W2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXk1ID0gYXJ0aXN0LmRheTtcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCBvbGREYXk2ID0gXCJcIjtcclxuICAgICAgdGhpcy5zZWNvbmREYXkuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5NiAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLnNlY29uZERheVtpbmRleF0uZmlyc3REYXkgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnNlY29uZERheVtpbmRleF0uZmlyc3REYXkgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2xkRGF5NiA9IGFydGlzdC5kYXk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBsZXQgb2xkRGF5NyA9IFwiXCI7XHJcbiAgICAgIHRoaXMudGhpcmREYXkuZm9yRWFjaCgoYXJ0aXN0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYob2xkRGF5NyAhPT0gYXJ0aXN0LmRheSl7XHJcbiAgICAgICAgICB0aGlzLnRoaXJkRGF5W2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMudGhpcmREYXlbaW5kZXhdLmZpcnN0RGF5ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9sZERheTcgPSBhcnRpc3QuZGF5O1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IG9sZERheTggPSBcIlwiO1xyXG4gICAgICB0aGlzLmZvdXJ0aERheS5mb3JFYWNoKChhcnRpc3QsaW5kZXgpID0+IHtcclxuICAgICAgICBpZihvbGREYXk4ICE9PSBhcnRpc3QuZGF5KXtcclxuICAgICAgICAgIHRoaXMuZm91cnRoRGF5W2luZGV4XS5maXJzdERheSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZm91cnRoRGF5W2luZGV4XS5maXJzdERheSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbGREYXk4ID0gYXJ0aXN0LmRheTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuYnlTZXRUaW1lID0gW10uY29uY2F0KHRoaXMuZmlyc3REYXksdGhpcy5zZWNvbmREYXksdGhpcy50aGlyZERheSx0aGlzLmZvdXJ0aERheSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXROb3RpZmljYXRpb24oYXJ0aXN0OiBhbnkpOiB2b2lkIHtcclxuICAgIExvY2FsTm90aWZpY2F0aW9ucy5zY2hlZHVsZShbe1xyXG4gICAgICBpZDogMSxcclxuICAgICAgdGl0bGU6ICdWYSBhIGVtcGV6YXInLFxyXG4gICAgICBib2R5OiAnUmVjdXJzIGV2ZXJ5IG1pbnV0ZSB1bnRpbCBjYW5jZWxsZWQnLFxyXG4gICAgICB0aWNrZXI6ICdUaGUgdGlja2VyJyxcclxuICAgICAgYmFkZ2U6IDEsXHJcbiAgICAgIGdyb3VwZWRNZXNzYWdlczpbXCJUaGUgZmlyc3RcIiwgXCJTZWNvbmRcIiwgXCJLZWVwIGdvaW5nXCIsIFwib25lIG1vcmUuLlwiLCBcIk9LIFN0b3BcIl0sIC8vYW5kcm9pZCBvbmx5XHJcbiAgICAgIGdyb3VwU3VtbWFyeTpcIlN1bW1hcnkgb2YgdGhlIGdyb3VwZWQgbWVzc2FnZXMgYWJvdmVcIiwgLy9hbmRyb2lkIG9ubHlcclxuICAgICAgb25nb2luZzogdHJ1ZSwgLy8gbWFrZXMgdGhlIG5vdGlmaWNhdGlvbiBvbmdvaW5nIChBbmRyb2lkIG9ubHkpXHJcbiAgICAgIHNtYWxsSWNvbjogJ3JlczovL2hlYXJ0JyxcclxuICAgICAgaW50ZXJ2YWw6ICdtaW51dGUnLFxyXG4gICAgICBzb3VuZDogXCJjdXN0b21zb3VuZC1pb3Mud2F2XCIsIC8vIGZhbGxzIGJhY2sgdG8gdGhlIGRlZmF1bHQgc291bmQgb24gQW5kcm9pZFxyXG4gICAgICBhdDogbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgKyAoMTAgKiAxMDAwKSkgLy8gMTAgc2Vjb25kcyBmcm9tIG5vd1xyXG4gICAgfV0pLnRoZW4oXHJcbiAgICAgICAgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIk5vdGlmaWNhdGlvbiBzY2hlZHVsZWRcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJzY2hlZHVsaW5nIGVycm9yOiBcIiArIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICApXHJcbiAgfVxyXG59Il19